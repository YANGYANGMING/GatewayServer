{% extends 'index.html' %}
{% load staticfiles %}
{% block main_content %}

<section class="content">

      <div class="box box-info">
            <div class="box-header with-border">
                <h3 class="box-title">新增用户</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body">
                <div class="row">
                <form method="post">{% csrf_token %}
                    <div class="col-xs-12 col-md-6 col-md-offset-1">
                            <div class="form-group">
                                <label for="name">用户名</label>
                                <input type="text" class="form-control" name="name" id="name" value=""  onblur="JudgeExist()">
                                <p id="name-msg" style="color: red;"></p>
                            </div>
                </div>
                    <div class="col-xs-12 col-md-6 col-md-offset-1">
                        <div class="form-group">
                            <label for="password">密码</label>
                            <input type="text" class="form-control" name="password" id="password" value="" >
                            <p id="password-msg" style="color: red;"></p>
                        </div>
                    </div>
                    <div  class="col-xs-12 col-md-6 col-md-offset-1">
                        <div class="form-group">
                            <label for="role">角色</label>
                            <select name="role" id="role" class="form-control" multiple="multiple" >
                                {% for role_item in roles_obj %}
                                    <option value="{{ role_item.id }}">{{ role_item.name }}</option>
                                {% endfor %}
                            </select>
                            <p id="role-msg" style="color: red;"></p>
                        </div>
                    </div>
                    <div  class="col-xs-12 col-md-6 col-md-offset-1">
                        <div class="form-group">
                            <label for="groups">权限组</label>
                            <select name="groups" id="groups" class="form-control" multiple="multiple" >
                                {% for group_item in groups_obj %}
                                    <option value="{{ group_item.id }}">{{ group_item.name }}</option>
                                {% endfor %}
                            </select>
                            <p id="groups-msg" style="color: red;"></p>
                        </div>
                    </div>
                    <div  class="col-xs-12 col-md-6 col-md-offset-1">
                        <div class="form-group">
                            <label for="gateway">网关</label>
                            <select name="gateway" id="gateway" class="form-control" multiple="multiple" >
                                {% for gateway_item in gateway_obj %}
                                    <option value="{{ gateway_item.id }}">{{ gateway_item.name }}</option>
                                {% endfor %}
                            </select>
                            <p id="gateway-msg" style="color: red;"></p>
                        </div>
                    </div>
{#                    <div  class="col-xs-12 col-md-6 col-md-offset-1">#}
{#                        <div class="form-group">#}
{#                            <label for="user_permissions">用户权限</label>#}
{#                            <select name="user_permissions" id="user_permissions" class="form-control " multiple="multiple" style="height: 150px;">#}
{#                                {% for user_permissions_item in cur_user_all_permissions_list %}#}
{#                                    <option value="{{ user_permissions_item.permissions__id }}">{{ user_permissions_item.permissions__name }}</option>#}
{#                                {% endfor %}#}
{#                            </select>#}
{#                        </div>#}
{#                    </div>#}
                    <div  class="col-xs-12 col-md-6 col-md-offset-1">
                        <div class="form-group">
                            <label for="is_active">允许登录</label>
                            <input type="checkbox" name="is_active" id="is_active" class="flat-green">
                        </div>
                    </div>
                    <div  class="col-xs-12 col-md-6 col-md-offset-1">
                        <div class="form-group">
                            <button type="button" class="btn btn-info col-md-offset-6" onfocus="JudgeNotNULL(this)">Save</button>
                        </div>
                    </div>
                </form>
            </div>
          </div>
      </div>

    </section>

{% endblock %}

{% block script %}
<script>

    $(function () {
        //Initialize Select2 Elements
        $('.select2').select2();

        //Flat red color scheme for iCheck
        $('input[type="checkbox"].flat-green, input[type="radio"].flat-green').iCheck({
            checkboxClass: 'icheckbox_flat-green',
            radioClass: 'iradio_flat-green'
        });

        //刷新页面后显示原来的值
        ShowOriginData();

    });

    function ShowOriginData() {
        $('#is_active').iCheck('check');

    }

    function JudgeExist() {
        var name = $('#name').val();
        $.ajax({
            url: '/GWS/judge-username-exist-json',
            data: {'name': name, 'previous_name': null},
            type: 'POST',
            dataType: 'JSON',
            success: function (arg) {
                $('#name-msg').html(arg.msg)
            }
        })

    }

    // 判断是否有未填写的选项
    function JudgeNotNULL(ths) {

        if ($('#name').val()[0]){
            $('#name-msg').html("");
        }else{
            $('#name-msg').html("姓名不能为空！");
        }
        if ($('#role').val()[0]){
            $('#role-msg').html("");
        }else{
            $('#role-msg').html("角色不能为空！");
        }
        if ($('#groups').val()[0]){
            $('#groups-msg').html("");
        }else{
            $('#groups-msg').html("权限组不能为空！");
        }
        if ($('#gateway').val()[0]){
            $('#gateway-msg').html("");
        }else{
            $('#gateway-msg').html("网关不能为空！");
        }
        if ($('#password').val()[0]){
            $('#password-msg').html("");
        }else{
            $('#password-msg').html("密码不能为空！");
        }

        if ($('#name').val()[0] &&
            $('#role').val()[0] &&
            $('#groups').val()[0] &&
            $('#gateway').val()[0] &&
            $('#password').val()[0]
        ){
            $(ths).attr('type', 'submit');
         }


    }


</script>

{% endblock %}

